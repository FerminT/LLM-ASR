SEED=42
CKPT_PATH=None
TEST_BATCH_SIZE=1
TEST_DATALOADER_NUM_WORKERS=1
MAX_DURATION=20
LLM='Qwen/Qwen2-1.5B'

$keys_not_saved=['model']
execute_pipeline:
    tasks = [@tasks.set_seed,
             @tasks.load_dataset,
             @tasks.load_tokenizer,
             @tasks.get_dataloaders,
             @tasks.load_model,
             @tasks.generate]
    execution_order = 'sequential'

tasks.set_seed.seed=%SEED
tasks.load_model.ckpt_path=%CKPT_PATH

tasks.load_dataset.postprocessors=[@processors.FilterByValue]
processors.FilterByValue:
    column='duration'
    value=%MAX_DURATION
    mode='lt'
tasks.get_dataloaders:
    dataset_cls={'test': @test/datasets.DictDataset}
    dataloader_cls={'test': @test/torch.utils.data.DataLoader}
    collate_fn=@datasets.InstructionCollator

tasks.load_tokenizer.hf_path=%LLM

test/torch.utils.data.DataLoader:
    shuffle=True
    batch_size=%TEST_BATCH_SIZE
    num_workers=%TEST_DATALOADER_NUM_WORKERS